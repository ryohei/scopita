# スコピタちゃん 仕様書 v1.0

## 1. サービス概要

### サービス名
**「スコピタちゃん」**

### キャッチコピー
「君たちのスコア、ピタッと記録！」

### コンセプト
麻雀の対局結果を記録・集計し、仲間内でのランキングや成績推移を可視化するWebアプリ。テンピタくんの姉妹サービス。

### ターゲットユーザー
- 定期的に麻雀を打つグループ（友人、サークル、職場など）
- 自分の成績を記録・振り返りたい人
- 仲間内でのランキングを楽しみたい人

---

## 2. 主要機能

### 2-1. ユーザー管理
| 機能 | 詳細 |
|------|------|
| ユーザー登録 | メールアドレス + パスワード |
| プロフィール | 表示名、アイコン |
| ログイン/ログアウト | セッション管理 |

### 2-2. グループ機能
| 機能 | 詳細 |
|------|------|
| グループ作成 | グループ名、ルール設定 |
| メンバー招待 | 招待リンク or 招待コード |
| メンバー管理 | 管理者権限、メンバー一覧 |
| 複数グループ参加 | 1ユーザーが複数グループに所属可能 |
| グループ別ルール | ウマ・オカ・持ち点などをグループごとに設定 |

### 2-3. 対局記録

#### 2つの記録モード

**① グループ対局**
- 既存グループのメンバーで対局
- グループのランキング・履歴に反映

**② 単発対局（フリー対局）**
- その日限りのメンバーと記録
- グループに紐づかない
- 自分の個人成績には反映

#### スコア入力の流れ

```
1. 対局モード選択（グループ or 単発）
2. 参加メンバー選択（4人）
3. ルール確認/設定（ウマ・オカなど）
4. 各半荘の素点を入力
   例: 45000, 28000, 15000, 12000
        ↓ 自動計算
   結果: +60, +8, -20, -48
5. 1日の集計を確認して保存
```

#### 自動計算ロジック
```
入力: 素点（持ち点終了時の点数）
  例: 45000点

計算:
  1. 返し点との差分: 45000 - 30000 = +15000
  2. 千点単位に: +15
  3. ウマ加算（1着なら+10）: +15 + 10 = +25
  4. オカ加算（トップ取り）: +25 + 20 = +45

出力: +45
```

### 2-4. 役満記録

#### 記録できる役満一覧

| 役満 | 読み |
|------|------|
| 国士無双 | こくしむそう |
| 四暗刻 | スーアンコー |
| 大三元 | ダイサンゲン |
| 字一色 | ツーイーソー |
| 小四喜 | ショウスーシー |
| 大四喜 | ダイスーシー |
| 緑一色 | リューイーソー |
| 清老頭 | チンロウトウ |
| 九蓮宝燈 | チューレンポウトウ |
| 四槓子 | スーカンツ |
| 天和 | テンホー |
| 地和 | チーホー |

### 2-5. 成績・ランキング

#### 個人成績（マイページ）
| 指標 | 説明 |
|------|------|
| 通算スコア | 全対局の合計ポイント |
| 対局数 | 半荘数 |
| 平均順位 | 1.00〜4.00 |
| トップ率 | 1着の割合 |
| ラス率 | 4着の割合 |
| 連対率 | 1着+2着の割合 |
| 役満回数 | 通算の役満達成数 |

#### グループランキング
| 期間 | 説明 |
|------|------|
| 週間 | 今週の成績 |
| 月間 | 今月の成績 |
| 3ヶ月 | 直近3ヶ月 |
| 年間 | 今年の成績 |
| 通算 | グループ開設以来 |

#### 表示項目
- 順位
- プレイヤー名
- トータルスコア
- 対局数
- 平均順位

---

## 3. 画面構成

### 画面一覧

| # | 画面名 | 概要 |
|---|--------|------|
| 1 | ログイン | メール+パスワード |
| 2 | 新規登録 | アカウント作成 |
| 3 | ホーム | ダッシュボード |
| 4 | グループ一覧 | 参加グループ |
| 5 | グループ詳細 | ランキング・履歴・メンバー |
| 6 | グループ設定 | ルール・メンバー管理 |
| 7 | 対局記録 | スコア入力 |
| 8 | 対局詳細 | 1日の対局まとめ |
| 9 | マイページ | 個人成績・設定 |

### 画面フロー

```
ログイン → ホーム
              │
    ┌─────────┼─────────┐
    ↓         ↓         ↓
グループ   対局記録   マイページ
一覧         │       - 個人成績
    │        │       - 設定
    ↓        ↓
グループ   対局詳細
詳細
- ランキング
- 対局履歴
- メンバー
```

### 主要画面のワイヤーフレーム

#### ホーム画面
```
┌────────────────────────────┐
│ 🀄 スコピタちゃん      [👤]  │
├────────────────────────────┤
│                            │
│  [ + 対局を記録する ]       │
│                            │
├────────────────────────────┤
│ 📊 最近の対局               │
│ ┌────────────────────────┐ │
│ │ 1/31 グループA  +45    │ │
│ │ 1/28 単発      -12     │ │
│ │ 1/25 グループA  +8     │ │
│ └────────────────────────┘ │
├────────────────────────────┤
│ 👥 参加グループ             │
│ ┌──────────┐ ┌──────────┐  │
│ │グループA │ │グループB │  │
│ │ 1位/4人  │ │ 3位/5人  │  │
│ └──────────┘ └──────────┘  │
│                            │
│ [ + グループを作成 ]        │
└────────────────────────────┘
```

#### 対局記録画面（スコア入力）
```
┌────────────────────────────┐
│ ← 対局記録                  │
├────────────────────────────┤
│ 📅 2025/01/31              │
│ 📍 グループA（東南戦）      │
├────────────────────────────┤
│ 半荘 1                      │
│ ┌────────────────────────┐ │
│ │ 田中   [  45000  ] → +60│ │
│ │ 鈴木   [  28000  ] → +8 │ │
│ │ 佐藤   [  15000  ] →-20 │ │
│ │ 山田   [  12000  ] →-48 │ │
│ └────────────────────────┘ │
│                            │
│ 🀄 役満が出た？ [+ 記録]    │
│ ┌────────────────────────┐ │
│ │ 🏆 田中: 国士無双       │ │
│ └────────────────────────┘ │
│                            │
│         [ + 半荘を追加 ]    │
├────────────────────────────┤
│ 📊 本日の集計               │
│ 田中: +60  鈴木: +8        │
│ 佐藤: -20  山田: -48       │
├────────────────────────────┤
│      [ 保存する ]           │
└────────────────────────────┘
```

#### グループ詳細画面
```
┌────────────────────────────┐
│ ← グループA          [⚙️]  │
├────────────────────────────┤
│ [ランキング] [履歴] [メンバー]│
├────────────────────────────┤
│ 期間: [月間 ▼]              │
├────────────────────────────┤
│ 🏆 ランキング               │
│ ┌────────────────────────┐ │
│ │ 1. 田中  +245  (12局)  │ │
│ │ 2. 鈴木  +120  (10局)  │ │
│ │ 3. 佐藤   -45  (11局)  │ │
│ │ 4. 山田  -320  (12局)  │ │
│ └────────────────────────┘ │
└────────────────────────────┘
```

---

## 4. データモデル

```sql
-- ユーザー
User
├── id: UUID (PK)
├── email: string (unique)
├── displayName: string
├── avatarUrl: string?
├── createdAt: timestamp
└── updatedAt: timestamp

-- グループ
Group
├── id: UUID (PK)
├── name: string
├── inviteCode: string (unique)
├── createdBy: UUID (FK → User)
├── createdAt: timestamp
└── updatedAt: timestamp

-- グループメンバー
GroupMember
├── id: UUID (PK)
├── groupId: UUID (FK → Group)
├── userId: UUID (FK → User)
├── role: enum (admin, member)
└── joinedAt: timestamp

-- グループルール設定
GroupRule
├── id: UUID (PK)
├── groupId: UUID (FK → Group, unique)
├── gameType: enum (東風, 東南)
├── startScore: int (25000)
├── returnScore: int (30000)
├── umaFirst: int (10)
├── umaSecond: int (5)
├── umaThird: int (-5)
├── umaFourth: int (-10)
├── hasOka: boolean
└── updatedAt: timestamp

-- 対局セッション（1日の対局まとめ）
GameSession
├── id: UUID (PK)
├── groupId: UUID? (FK → Group, null=単発)
├── date: date
├── createdBy: UUID (FK → User)
├── createdAt: timestamp
└── updatedAt: timestamp

-- 対局セッション参加者（単発対局用のゲスト名も保存）
SessionPlayer
├── id: UUID (PK)
├── sessionId: UUID (FK → GameSession)
├── userId: UUID? (FK → User, null=ゲスト)
├── guestName: string? (ゲスト時の表示名)
└── index: int (席順)

-- 半荘
Game
├── id: UUID (PK)
├── sessionId: UUID (FK → GameSession)
├── gameNumber: int (1, 2, 3...)
└── createdAt: timestamp

-- 半荘結果
GameResult
├── id: UUID (PK)
├── gameId: UUID (FK → Game)
├── playerId: UUID (FK → SessionPlayer)
├── rank: int (1-4)
├── rawScore: int (素点: 45000)
├── score: int (計算後: +60)
└── createdAt: timestamp

-- 役満記録
Yakuman
├── id: UUID (PK)
├── gameId: UUID (FK → Game)
├── playerId: UUID (FK → SessionPlayer)
├── type: enum (国士無双, 四暗刻, 大三元, ...)
└── createdAt: timestamp
```

---

## 5. ルール設定

### デフォルト設定
| 項目 | デフォルト値 |
|------|-------------|
| 対局形式 | 東南戦 |
| 持ち点 | 25000点 |
| 返し点 | 30000点 |
| ウマ | 10-20（1着+20, 2着+10, 3着-10, 4着-20） |
| オカ | あり（トップに+20） |

### スコア計算式
```
score = (rawScore - returnScore) / 1000 + uma + oka

例: 1着 45000点（ウマ10-20、オカあり）
  = (45000 - 30000) / 1000 + 20 + 20
  = 15 + 20 + 20
  = +55
```

---

## 6. 技術スタック

| レイヤー | 技術 | 理由 |
|---------|------|------|
| フロントエンド | React 18 + TypeScript | テンピタくんと統一 |
| スタイリング | Tailwind CSS | テンピタくんと統一 |
| ビルド | Vite | テンピタくんと統一 |
| ルーティング | React Router v7 | SPA対応 |
| 認証 | Supabase Auth | メール認証が簡単 |
| データベース | Supabase (PostgreSQL) | RLS、リアルタイム |
| ホスティング | Vercel | 既存と同じ |
| グラフ | Recharts | 成績推移の可視化 |

---

## 7. テンピタくんとの連携

### 相互リンク
- **テンピタくん** → ヘッダーに「📊 スコア記録」リンク追加
- **スコピタちゃん** → ヘッダーに「🧮 符計算」リンク追加

### デザイン統一
- カラーパレット共通（mahjong-table, mahjong-red, cream）
- フォント共通（M PLUS Rounded 1c）
- キャラクターの世界観を統一

---

## 8. 将来的な拡張案（Phase 2以降）

- [ ] Google/LINE認証の追加
- [ ] 3人麻雀（サンマ）対応
- [ ] テンピタくんとの連携（計算結果をスコアに反映）
- [ ] 役の記録（リーチ、タンヤオなど）
- [ ] 写真添付（牌姿の記録）
- [ ] チップ（祝儀）の記録
- [ ] プッシュ通知
- [ ] エクスポート機能（CSV出力）
- [ ] 成績推移グラフ

---

## 9. MVP（最小限リリース）の範囲

Phase 1として、以下を優先実装：

1. ユーザー登録・ログイン（メール認証）
2. グループ作成・招待
3. グループルール設定
4. 対局記録（グループ・単発両対応）
5. スコア自動計算
6. 役満記録
7. グループランキング（期間指定）
8. 個人成績（マイページ）
9. テンピタくんとの相互リンク
